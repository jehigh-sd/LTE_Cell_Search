#ifndef LTE_CELL_SEARCH_H_
#define LTE_CELL_SEARCH_H_

#include "data_types.h"

#define SIZE_FFT   128
#define PSS_THRESH 0.4786
#define LOW_THRESH 0.01

// ADC input is 12-bit signed zero padded to 16-bits making it 16-bit signed.
#define ADC_SCALE_M_FACTOR  32768.0           // 2^15
#define ADC_SCALE_D_FACTOR  0.000122070312500 // 2^-15 * 2^2 (with 2-Bit Gain)
#define PSS_SCALE_D_FACTOR  0.25              // 2^-2 (2-Bit Trim)
#define INT32_SCALE_FACTOR  10000.0           // Utilize all Bits of 32-Bit Integer

#define NUM_INPUT_SAMPLES   96000

/*PSS sequences*/
const coef_t td_pss_real[3][SIZE_FFT] = {
	             { 0.07416495457855915, 0.01999507272612425, -0.06996209230712840, -0.07973525039809337, -0.00211851523912414, 0.07185900105161525, 0.07880309627732059, 0.03420056131241091, -0.02076452348263825, -0.06316033644717833, -0.08478375106834155, -0.08951018576677262, -0.09288218159111337, -0.09968875611089913, -0.09633932653779878, -0.08182673947622512, -0.07327407226567964, -0.06063194120803879, -0.00650646233153177, 0.07412566753058060, 0.09582656324236767, 0.02163083247588002, -0.05995744623995231, -0.05312690121592920, 0.00455290495979553, 0.01415462083825947, -0.01855966212282201, -0.00840186518556994, 0.04099902225621363, 0.03076348223491690, -0.05711885200247557, -0.10882820420620593, -0.04924004708845642, 0.04886644322532326, 0.08626526263395562, 0.07229686700294657, 0.06898549540035225, 0.08052423217196573, 0.07596503001655422, 0.06345726316352829, 0.06924279184446536, 0.08386739753025031, 0.08390593782491165, 0.06649088264331256, 0.02571448928389105, -0.04651592107699448, -0.10266722202262865, -0.06580154841431063, 0.03775735277542229, 0.07205573198800300, -0.00975795236524119, -0.07193922213260938, -0.00719887918477861, 0.07370993116518479, 0.01626516758766340, -0.10754906513013093, -0.09885436692961118, 0.04648735336408006, 0.13123100980082780, 0.07187170642352510, 0.00233400867347615, 0.01871395961121975, 0.03321726285666359, -0.02835506969015938, -0.07632503988764325, -0.02835506969011106, 0.03321726285667146, 0.01871395961115649, 0.00233400867342540, 0.07187170642355858, 0.13123100980089530, 0.04648735336408535, -0.09885436692967038, -0.10754906513016990, 0.01626516758768781, 0.07370993116522301, -0.00719887918478263, -0.07193922213264008, -0.00975795236524957, 0.07205573198802255, 0.03775735277543277, -0.06580154841432725, -0.10266722202264650, -0.04651592107698393, 0.02571448928392187, 0.06649088264332879, 0.08390593782489554, 0.08386739753022161, 0.06924279184445495, 0.06345726316353839, 0.07596503001655759, 0.08052423217194578, 0.06898549540032828, 0.07229686700294545, 0.08626526263397027, 0.04886644322532343, -0.04924004708847612, -0.10882820420621683, -0.05711885200246066, 0.03076348223493545, 0.04099902225621004, -0.00840186518558494, -0.01855966212282076, 0.01415462083827621, 0.00455290495980132, -0.05312690121594328, -0.05995744623996629, 0.02163083247588089, 0.09582656324237340, 0.07412566753057970, -0.00650646233153266, -0.06063194120803223, -0.07327407226567556, -0.08182673947623409, -0.09633932653781072, -0.09968875611089757, -0.09288218159110281, -0.08951018576677189, -0.08478375106835426, -0.06316033644718963, -0.02076452348264026, 0.03420056131241060, 0.07880309627732010, 0.07185900105162657, -0.00211851523909847, -0.07973525039807421, -0.06996209230713339, 0.01999507272610853},
                 {-0.076597,-0.036095,0.044867,0.094432,0.093885,0.08487,0.092934,0.085228,0.031262,-0.03292,-0.05109,-0.030207,-0.014726,0.0012848,0.053602,0.10579,0.071676,-0.035455,-0.084708,-0.013943,0.067044,0.038554,-0.055586,-0.097565,-0.080051,-0.077768,-0.090909,-0.056518,0.010016,0.026157,-0.0069191,-1.5941e-06,0.064919,0.10377,0.083428,0.071417,0.093382,0.077891,0.0035863,-0.033588,0.016767,0.054864,-0.0089845,-0.10215,-0.11434,-0.072067,-0.056296,-0.039601,0.037154,0.099164,0.030781,-0.10322,-0.12102,-0.0082102,0.052245,-0.029792,-0.11587,-0.070182,0.033734,0.04771,-0.027663,-0.074986,-0.040686,0.02313,0.051733,0.02313,-0.040686,-0.074986,-0.027663,0.04771,0.033734,-0.070182,-0.11587,-0.029792,0.052245,-0.0082102,-0.12102,-0.10322,0.030781,0.099164,0.037154,-0.039601,-0.056296,-0.072067,-0.11434,-0.10215,-0.0089845,0.054864,0.016767,-0.033588,0.0035863,0.077891,0.093382,0.071417,0.083428,0.10377,0.064919,-1.5941e-06,-0.0069191,0.026157,0.010016,-0.056518,-0.090909,-0.077768,-0.080051,-0.097565,-0.055586,0.038554,0.067044,-0.013943,-0.084708,-0.035455,0.071676,0.10579,0.053602,0.0012848,-0.014726,-0.030207,-0.05109,-0.03292,0.031262,0.085228,0.092934,0.08487,0.093885,0.094432,0.044867,-0.036095},
                 {-0.076597,-0.036095,0.044867,0.094432,0.093885,0.08487,0.092934,0.085228,0.031262,-0.03292,-0.05109,-0.030207,-0.014726,0.0012848,0.053602,0.10579,0.071676,-0.035455,-0.084708,-0.013943,0.067044,0.038554,-0.055586,-0.097565,-0.080051,-0.077768,-0.090909,-0.056518,0.010016,0.026157,-0.0069191,-1.5941e-06,0.064919,0.10377,0.083428,0.071417,0.093382,0.077891,0.0035863,-0.033588,0.016767,0.054864,-0.0089845,-0.10215,-0.11434,-0.072067,-0.056296,-0.039601,0.037154,0.099164,0.030781,-0.10322,-0.12102,-0.0082102,0.052245,-0.029792,-0.11587,-0.070182,0.033734,0.04771,-0.027663,-0.074986,-0.040686,0.02313,0.051733,0.02313,-0.040686,-0.074986,-0.027663,0.04771,0.033734,-0.070182,-0.11587,-0.029792,0.052245,-0.0082102,-0.12102,-0.10322,0.030781,0.099164,0.037154,-0.039601,-0.056296,-0.072067,-0.11434,-0.10215,-0.0089845,0.054864,0.016767,-0.033588,0.0035863,0.077891,0.093382,0.071417,0.083428,0.10377,0.064919,-1.5941e-06,-0.0069191,0.026157,0.010016,-0.056518,-0.090909,-0.077768,-0.080051,-0.097565,-0.055586,0.038554,0.067044,-0.013943,-0.084708,-0.035455,0.071676,0.10579,0.053602,0.0012848,-0.014726,-0.030207,-0.05109,-0.03292,0.031262,0.085228,0.092934,0.08487,0.093885,0.094432,0.044867,-0.036095}};

const coef_t td_pss_imag[3][SIZE_FFT] = {
		         {-0.05063670251303750, -0.00481822921844818, 0.04870695099660497, 0.00033871407236546, -0.09471135086161010, -0.09342421544409239, 0.01530962813189041, 0.09929634598505648, 0.08304027803843594, 0.03386973294739670, 0.02513608327952927, 0.02898294086111359, -0.00013607058409953, -0.02917949871558465, -0.00885430819078642, 0.03461893482098891, 0.04952419647570858, 0.04961848903707017, 0.07017126933339181, 0.07356554563472481, 0.00064356154538339, -0.09926628747342937, -0.10233319112417393, 0.00525344700905458, 0.08250757977124884, 0.02633437498328941, -0.07864118368649765, -0.08234187103269278, 0.01842269548712944, 0.08639952291670898, 0.03937656175600075, -0.05714595945962821, -0.10277218192915590, -0.08430658913719258, -0.04960888816434372, -0.02172075731343192, 0.00862311028172180, 0.03766664786314187, 0.04690066906663744, 0.03689781182297271, 0.02520187708557808, 0.01261957420256766, -0.01834475006836759, -0.06748030629526022, -0.10183136702342846, -0.08676103556990447, -0.02442540134598209, 0.04149102629202334, 0.05829638170069671, 0.01118229797002270, -0.05428214968330669, -0.06886605407750987, -0.01401858744399071, 0.05003507193134984, 0.04902170983223922, -0.01935310277320093, -0.08532877912365552, -0.08908722826473429, -0.03761146022838739, 0.02254192416146765, 0.06084537860118276, 0.07674561032310009, 0.07947846009554305, 0.07629312194068745, 0.07402325847075705, 0.07629312194072567, 0.07947846009556830, 0.07674561032308641, 0.06084537860116325, 0.02254192416147666, -0.03761146022836812, -0.08908722826474252, -0.08532877912368596, -0.01935310277321297, 0.04902170983225915, 0.05003507193136941, -0.01401858744400082, -0.06886605407753722, -0.05428214968332008, 0.01118229797003269, 0.05829638170071687, 0.04149102629204325, -0.02442540134596352, -0.08676103556989215, -0.10183136702343192, -0.06748030629527808, -0.01834475006838376, 0.01261957420256690, 0.02520187708558920, 0.03689781182298051, 0.04690066906663246, 0.03766664786312957, 0.00862311028171572, -0.02172075731342423, -0.04960888816432787, -0.08430658913718050, -0.10277218192915330, -0.05714595945963212, 0.03937656175599344, 0.08639952291669770, 0.01842269548711676, -0.08234187103269892, -0.07864118368649413, 0.02633437498329573, 0.08250757977125282, 0.00525344700906176, -0.10233319112416069, -0.09926628747342321, 0.00064356154537047, 0.07356554563470723, 0.07017126933339637, 0.04961848903709457, 0.04952419647571834, 0.03461893482096652, -0.00885430819081308, -0.02917949871558278, -0.00013607058407992, 0.02898294086111631, 0.02513608327951264, 0.03386973294739169, 0.08304027803845343, 0.09929634598506849, 0.01530962813187672, -0.09342421544411196, -0.09471135086160982, 0.00033871407237574, 0.04870695099660068, -0.00481822921846253},
                 { 0.046877,0.0036962,-0.066588,-0.064316,0.015778,0.070208,0.021409,-0.071606,-0.084232,0.004915,0.079264,0.040188,-0.061588,-0.10408,-0.063691,-0.029719,-0.056795,-0.08732,-0.05152,0.024831,0.067464,0.060949,0.043716,0.025691,-0.013057,-0.048651,-0.020406,0.065549,0.11116,0.050949,-0.050112,-0.078875,-0.018407,0.051355,0.073318,0.061853,0.036792,-0.011233,-0.064501,-0.059043,0.026031,0.10876,0.097992,0.020246,-0.014916,0.032086,0.084572,0.071216,0.024491,0.015025,0.038945,0.032548,-0.023591,-0.078877,-0.091209,-0.074017,-0.049547,-0.0079646,0.052803,0.086534,0.048003,-0.034144,-0.083991,-0.076752,-0.06205,-0.076752,-0.083991,-0.034144,0.048003,0.086534,0.052803,-0.0079646,-0.049547,-0.074017,-0.091209,-0.078877,-0.023591,0.032548,0.038945,0.015025,0.024491,0.071216,0.084572,0.032086,-0.014916,0.020246,0.097992,0.10876,0.026031,-0.059043,-0.064501,-0.011233,0.036792,0.061853,0.073318,0.051355,-0.018407,-0.078875,-0.050112,0.050949,0.11116,0.065549,-0.020406,-0.048651,-0.013057,0.025691,0.043716,0.060949,0.067464,0.024831,-0.05152,-0.08732,-0.056795,-0.029719,-0.063691,-0.10408,-0.061588,0.040188,0.079264,0.004915,-0.084232,-0.071606,0.021409,0.070208,0.015778,-0.064316,-0.066588,0.0036962},
                 {-0.046877,-0.0036962,0.066588,0.064316,-0.015778,-0.070208,-0.021409,0.071606,0.084232,-0.004915,-0.079264,-0.040188,0.061588,0.10408,0.063691,0.029719,0.056795,0.08732,0.05152,-0.024831,-0.067464,-0.060949,-0.043716,-0.025691,0.013057,0.048651,0.020406,-0.065549,-0.11116,-0.050949,0.050112,0.078875,0.018407,-0.051355,-0.073318,-0.061853,-0.036792,0.011233,0.064501,0.059043,-0.026031,-0.10876,-0.097992,-0.020246,0.014916,-0.032086,-0.084572,-0.071216,-0.024491,-0.015025,-0.038945,-0.032548,0.023591,0.078877,0.091209,0.074017,0.049547,0.0079646,-0.052803,-0.086534,-0.048003,0.034144,0.083991,0.076752,0.06205,0.076752,0.083991,0.034144,-0.048003,-0.086534,-0.052803,0.0079646,0.049547,0.074017,0.091209,0.078877,0.023591,-0.032548,-0.038945,-0.015025,-0.024491,-0.071216,-0.084572,-0.032086,0.014916,-0.020246,-0.097992,-0.10876,-0.026031,0.059043,0.064501,0.011233,-0.036792,-0.061853,-0.073318,-0.051355,0.018407,0.078875,0.050112,-0.050949,-0.11116,-0.065549,0.020406,0.048651,0.013057,-0.025691,-0.043716,-0.060949,-0.067464,-0.024831,0.05152,0.08732,0.056795,0.029719,0.063691,0.10408,0.061588,-0.040188,-0.079264,-0.004915,0.084232,0.071606,-0.021409,-0.070208,-0.015778,0.064316,0.066588,-0.0036962}};

void lteCellSearch(hls::stream<sample_pkt> &IN_R, hls::stream<sample_pkt> &IN_I,
                   int *OUT_PSS_ID, int *OUT_PEAK_INDEX, int *OUT_RSLT);

#endif /* LTE_CELL_SEARCH_H_ */
