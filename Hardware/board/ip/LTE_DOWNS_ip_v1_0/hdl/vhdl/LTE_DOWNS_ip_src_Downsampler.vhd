-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\hdlsrc\zynqRadioHWSWLTEDecimatorRFSoC2x2\LTE_DOWNS_ip_src_Downsampler.vhd
-- Created: 2022-05-25 12:29:42
-- 
-- Generated by MATLAB 9.12 and HDL Coder 3.20
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: LTE_DOWNS_ip_src_Downsampler
-- Source Path: zynqRadioHWSWLTEDecimatorRFSoC2x2/LTE_DOWNSAMPLE_HDL/DOWNSAMPLE/Downsampler
-- Hierarchy Level: 2
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;
USE work.LTE_DOWNS_ip_src_LTE_DOWNSAMPLE_HDL_pac.ALL;

ENTITY LTE_DOWNS_ip_src_Downsampler IS
  PORT( clk                               :   IN    std_logic;
        reset_x                           :   IN    std_logic;
        enb_1_32_0                        :   IN    std_logic;
        enb                               :   IN    std_logic;
        enb_1_1_1                         :   IN    std_logic;
        In1_re                            :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En15
        In1_im                            :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En15
        Out1_re                           :   OUT   std_logic_vector(15 DOWNTO 0);  -- uint16
        Out1_im                           :   OUT   std_logic_vector(15 DOWNTO 0)  -- uint16
        );
END LTE_DOWNS_ip_src_Downsampler;


ARCHITECTURE rtl OF LTE_DOWNS_ip_src_Downsampler IS

  -- Component Declarations
  COMPONENT LTE_DOWNS_ip_src_Front_End_FIR_Decimation
    PORT( clk                             :   IN    std_logic;
          enb_1_1_1                       :   IN    std_logic;
          reset_x                         :   IN    std_logic;
          LTE_DOWNS_ip_src_Front_End_FIR_Decimation_in_re :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En15
          LTE_DOWNS_ip_src_Front_End_FIR_Decimation_in_im :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En15
          LTE_DOWNS_ip_src_Front_End_FIR_Decimation_out_re :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En15
          LTE_DOWNS_ip_src_Front_End_FIR_Decimation_out_im :   OUT   std_logic_vector(15 DOWNTO 0)  -- sfix16_En15
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : LTE_DOWNS_ip_src_Front_End_FIR_Decimation
    USE ENTITY work.LTE_DOWNS_ip_src_Front_End_FIR_Decimation(rtl);

  -- Signals
  SIGNAL In1_re_signed                    : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL In1_im_signed                    : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Gain1_cast                       : signed(31 DOWNTO 0);  -- sfix32_En25
  SIGNAL Gain1_out                        : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Gain11_cast                      : signed(31 DOWNTO 0);  -- sfix32_En25
  SIGNAL Gain1_out_1                      : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Delay6_out1_re                   : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Delay6_out1_im                   : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL delayMatch_reg_re                : vector_of_signed16(0 TO 31);  -- sfix16_En15 [32]
  SIGNAL delayMatch_reg_im                : vector_of_signed16(0 TO 31);  -- sfix16_En15 [32]
  SIGNAL Delay6_out1_re_1                 : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Delay6_out1_im_1                 : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Delay6_out1_re_2                 : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL Delay6_out1_im_2                 : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL Front_End_FIR_Decimation_out1_reg_re : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL Front_End_FIR_Decimation_out1_reg_im : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL Front_End_FIR_Decimation_out1_reg_re_signed : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_reg_im_signed : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_re : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_im : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_re_1 : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_im_1 : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_re_2 : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Front_End_FIR_Decimation_out1_im_2 : signed(15 DOWNTO 0);  -- sfix16_En15
  SIGNAL Data_Type_Conversion_out1_re     : unsigned(15 DOWNTO 0);  -- uint16
  SIGNAL Data_Type_Conversion_out1_im     : unsigned(15 DOWNTO 0);  -- uint16

BEGIN
  u_LTE_DOWNS_ip_src_Front_End_FIR_Decimation : LTE_DOWNS_ip_src_Front_End_FIR_Decimation
    PORT MAP( clk => clk,
              enb_1_1_1 => enb_1_1_1,
              reset_x => reset_x,
              LTE_DOWNS_ip_src_Front_End_FIR_Decimation_in_re => Delay6_out1_re_2,  -- sfix16_En15
              LTE_DOWNS_ip_src_Front_End_FIR_Decimation_in_im => Delay6_out1_im_2,  -- sfix16_En15
              LTE_DOWNS_ip_src_Front_End_FIR_Decimation_out_re => Front_End_FIR_Decimation_out1_reg_re,  -- sfix16_En15
              LTE_DOWNS_ip_src_Front_End_FIR_Decimation_out_im => Front_End_FIR_Decimation_out1_reg_im  -- sfix16_En15
              );

  In1_re_signed <= signed(In1_re);

  Gain1_cast <= resize(In1_re_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 32);
  
  Gain1_out <= X"7FFF" WHEN (Gain1_cast(31) = '0') AND (Gain1_cast(30 DOWNTO 25) /= "000000") ELSE
      X"8000" WHEN (Gain1_cast(31) = '1') AND (Gain1_cast(30 DOWNTO 25) /= "111111") ELSE
      Gain1_cast(25 DOWNTO 10);

  In1_im_signed <= signed(In1_im);

  Gain11_cast <= resize(In1_im_signed & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0' & '0', 32);
  
  Gain1_out_1 <= X"7FFF" WHEN (Gain11_cast(31) = '0') AND (Gain11_cast(30 DOWNTO 25) /= "000000") ELSE
      X"8000" WHEN (Gain11_cast(31) = '1') AND (Gain11_cast(30 DOWNTO 25) /= "111111") ELSE
      Gain11_cast(25 DOWNTO 10);

  Delay6_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        Delay6_out1_re <= to_signed(16#0000#, 16);
        Delay6_out1_im <= to_signed(16#0000#, 16);
      ELSIF enb = '1' THEN
        Delay6_out1_re <= Gain1_out;
        Delay6_out1_im <= Gain1_out_1;
      END IF;
    END IF;
  END PROCESS Delay6_process;


  delayMatch_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        delayMatch_reg_re <= (OTHERS => to_signed(16#0000#, 16));
        delayMatch_reg_im <= (OTHERS => to_signed(16#0000#, 16));
      ELSIF enb = '1' THEN
        delayMatch_reg_im(0) <= Delay6_out1_im;
        delayMatch_reg_im(1 TO 31) <= delayMatch_reg_im(0 TO 30);
        delayMatch_reg_re(0) <= Delay6_out1_re;
        delayMatch_reg_re(1 TO 31) <= delayMatch_reg_re(0 TO 30);
      END IF;
    END IF;
  END PROCESS delayMatch_process;

  Delay6_out1_re_1 <= delayMatch_reg_re(31);
  Delay6_out1_im_1 <= delayMatch_reg_im(31);

  Delay6_out1_re_2 <= std_logic_vector(Delay6_out1_re_1);

  Delay6_out1_im_2 <= std_logic_vector(Delay6_out1_im_1);

  Front_End_FIR_Decimation_out1_reg_re_signed <= signed(Front_End_FIR_Decimation_out1_reg_re);

  Front_End_FIR_Decimation_out1_reg_im_signed <= signed(Front_End_FIR_Decimation_out1_reg_im);

  Front_End_FIR_Decimation_reg_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        Front_End_FIR_Decimation_out1_re <= to_signed(16#0000#, 16);
        Front_End_FIR_Decimation_out1_im <= to_signed(16#0000#, 16);
      ELSIF enb_1_32_0 = '1' THEN
        Front_End_FIR_Decimation_out1_re <= Front_End_FIR_Decimation_out1_reg_re_signed;
        Front_End_FIR_Decimation_out1_im <= Front_End_FIR_Decimation_out1_reg_im_signed;
      END IF;
    END IF;
  END PROCESS Front_End_FIR_Decimation_reg_process;


  Front_End_FIR_Decimation_out1_re_1 <= Front_End_FIR_Decimation_out1_re;

  Front_End_FIR_Decimation_out1_im_1 <= Front_End_FIR_Decimation_out1_im;

  Front_End_FIR_Decimation_outbuff_out_pipe_process : PROCESS (clk)
  BEGIN
    IF clk'EVENT AND clk = '1' THEN
      IF reset_x = '1' THEN
        Front_End_FIR_Decimation_out1_re_2 <= to_signed(16#0000#, 16);
        Front_End_FIR_Decimation_out1_im_2 <= to_signed(16#0000#, 16);
      ELSIF enb = '1' THEN
        Front_End_FIR_Decimation_out1_re_2 <= Front_End_FIR_Decimation_out1_re_1;
        Front_End_FIR_Decimation_out1_im_2 <= Front_End_FIR_Decimation_out1_im_1;
      END IF;
    END IF;
  END PROCESS Front_End_FIR_Decimation_outbuff_out_pipe_process;


  Data_Type_Conversion_out1_re <= unsigned(Front_End_FIR_Decimation_out1_re_2);
  Data_Type_Conversion_out1_im <= unsigned(Front_End_FIR_Decimation_out1_im_2);

  Out1_re <= std_logic_vector(Data_Type_Conversion_out1_re);

  Out1_im <= std_logic_vector(Data_Type_Conversion_out1_im);

END rtl;

